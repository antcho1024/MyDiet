<!DOCTYPE html>
<html lang="en">
<head>
    <!--    <meta charset="utf-8">-->
    <!--    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">-->
    <meta charset="UTF-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <title>Title</title>


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <!--OG-->
    <title>My Diet</title>
    <meta name="description" content="Hanghae99 Mini Project My Diet"/>
    <meta name="author" content="GroupB8"/>

    <!--Favicon-->
    <link rel="icon" type="image/png" href="./imgs/favicon.png"/>

    <!--CSS FontAwesome-->
    <script
            src="https://kit.fontawesome.com/92993542cc.js"
            crossorigin="anonymous"
    ></script>

    <!--CSS BULMA-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <!--GoogleFont-->
    <link rel="preconnect" href="https://fonts.googleapis.com"/>
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
    <link
            href="https://fonts.googleapis.com/css2?family=Gugi&family=Jua&display=swap"
            rel="stylesheet"
    />

    <!-- JS -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.js"></script>

    <link rel="stylesheet" href="./static/header1.css"/>

    <script>
        $(document).ready(function () {
            get_posts('food');
        });

        function get_posts(category) {

            $("#post-box").empty()
            $.ajax({
                type: "GET",
                url: `/get_posts?category_give=${category}`,
                data: {},
                success: function (response) {
                    console.log(response['all_posts'])
                    let posts = response['all_posts']
                    for (let i = 0; i < posts.length; i++) {
                        let image = posts[i]['image']
                        let comment = posts[i]['cooment']
                        let id = posts[i]['post_id']
                        {#let count_heart = post['count_heart']#}
                        {#let class_heart = post['heart_by_me'] ? "fa-heart" : "fa-heart-o"#}
                        let comment_short = comment.length <15 ? comment : comment.slice(0,35) +'...'

                        let temp_html = `<div class="card" onclick='$("#modal-post_${id}").addClass("is-active")'>
                                            <div class="card-image">
                                                <figure class="image is-4by3">
                                                    <img src="${image}" alt="Placeholder image">
                                                </figure>
                                            </div>
                                            <div class="card-content">
                                                <div class="media">
                                                    <div class="media-content">
                                                        <p class="title is-4">John Smith</p>

                                                    </div>
                                                    <div class="media-left">
                                                        <nav class="level is-mobile">
                                                            <div class="level-left">
                                                                <a class="level-item is-sparta" aria-label="heart" onclick="toggle_like('{id})">
                                                                    {#<span class="icon is-small"><i class="fa ${class_heart}"#}
                                                                    {#                               aria-hidden="true"></i></span>&nbsp;<span class="like-num">${num2str(count_heart)}</span>#}
                                                                    <span class="icon is-small"><i class="fa fa-heart"
                                                                                                               aria-hidden="true"></i></span>&nbsp;<span
                                                                                    class="like-num">2.7k</span>
                                                                </a>
                                                            </div>

                                                        </nav>
                                                    </div>
                                                </div>

                                                <div class="content">
                                                    ${comment_short}
                                                    <br>
                                                    <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
                                                </div>
                                            </div>
                                        </div>


                                        <div class="modal" id="modal-post_${id}">
                                                <div class="modal-background" onclick='$("#modal-post_${id}").removeClass("is-active")'></div>
                                                <div class="modal-content">
                                                    <!-- Any other Bulma elements you want -->
                                                    <div class="card">
                                                        <div class="card-image">
                                                            <figure class="image is-4by3">
                                                                <img src="${image}" alt="Placeholder image">
                                                            </figure>
                                                        </div>
                                                        <div class="card-content">
                                                            <div class="media">
                                                                <div class="media-left">
                                                                    <figure class="image is-48x48">
                                                                        <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">
                                                                    </figure>
                                                                </div>
                                                                <div class="media-content">
                                                                    <p class="title is-4">John Smith</p>

                                                                </div>
                                                                <div class="media-left">
                                                                    <nav class="level is-mobile">
                                                                        <div class="level-left">
                                                                            <a class="level-item is-sparta" aria-label="heart" onclick="toggle_like(${id})">
                                                                                <span class="icon is-small"><i class="fa fa-heart"
                                                                                                               aria-hidden="true"></i></span>&nbsp;<span
                                                                                    class="like-num">2.7k</span>
                                                                            </a>
                                                                        </div>
                                                                    </nav>
                                                                </div>
                                                            </div>


                                                            <div class="content">
                                                                ${comment}
                                                                <br>
                                                                <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>
                                                            </div>

                                                        </nav>
                                                    </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <button class="modal-close is-large" aria-label="close"
                                                        onclick='$("#modal-post_${id}").removeClass("is-active")'></button>
                                            </div>`
                        $('#post-box').append(temp_html)
                    }
                }
            })
        }

        function posting_test() {
            $.ajax({
                type: "POST",
                url: "/posting_test",
                data: {comment_give: '테스트입니다 여기엔 코멘트가 들어갑니다!! 사진 크기가 아니라 글자길이인가???????ㅏㅏㅏㅏㅏㅏㅏㅏㅏㅏㅏ그렇넹', image_give: "./static/smaple_1.PNG", category: 'food'},
                success: function (response) {
                    console.log(response['msg'])
                }
            })
        }

        function toggle_like(post_id, type) {
            console.log(post_id)
            let $a_like = $(`#${post_id} a[aria-label='heart']`)
            let $i_like = $a_like.find("i")
            if ($i_like.hasClass("fa-heart")) {
                $.ajax({
                    type: "POST",
                    url: "/update_like",
                    data: {
                        post_id_give: post_id,
                        action_give: "unlike"
                    },
                    success: function (response) {
                        console.log("unlike")
                        {#$i_like.addClass("fa-heart-o").removeClass("fa-heart")#}
                        {#$a_like.find("span.like-num").text(response["count"])#}
                    }
                })
            } else {
                $.ajax({
                    type: "POST",
                    url: "/update_like",
                    data: {
                        post_id_give: post_id,
                        action_give: "like"
                    },
                    success: function (response) {
                        console.log("like")
                        {#$i_like.addClass("fa-heart").removeClass("fa-heart-o")#}
                        {#$a_like.find("span.like-num").text(num2str(response["count"]))#}
                    }
                })

            }
        }
        function num2str(count) {
            if (count > 10000) {
                return parseInt(count / 1000) + "k"
            }
            if (count > 500) {
                return parseInt(count / 100) / 10 + "k"
            }
            if (count == 0) {
                return ""
            }
            return count
        }

    </script>
    <style>
        .post {
            width: 95%;
            max-width: 3000px;
            margin: 20px auto 0px auto;
            padding: 20px;

            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            flex-wrap: wrap;

        }

        .post > .card {
            margin-right: 35px;
            margin-top: 50px;
            width: 30%;
        }


    </style>
</head>
<body>
<header id="header">
    <div class="header__logo">
        <img class="fab" src="{{ url_for('static', filename='favicon.png') }}" alt="favicon"/>
        <a href="/">My Diet</a>
    </div>

    <ul class="header__navbar">
        <li class="header__navbar__item" onclick="get_posts('body')">바디</li>
        <li class="header__navbar__item" onclick="get_posts('food')">식단</li>
        <li class="header__navbar__item" onclick="get_posts('exercise')">운동</li>
        <li class="header__navbar__item" onclick="get_posts('supplement')">보조제</li>
    </ul>

    <div class="header__account">
        <div class="account__profile">
            <div class="profile__box">
                <img
                        class="account__profile_picture"
                        src="{{ url_for('static', filename='profile_placeholder.png') }}"
                        alt="profile picture"
                />
            </div>

            <p class="account__profile__nickname">XXX 님</p>
        </div>
        <a href="#" class="account__mypage">마이페이지</a>
        <a href="#" class="account__signout">로그아웃</a>
        <a href="#" class="account__signin">로그인</a>
        <a href="#" class="account__signup">회원가입</a>
    </div>
</header>


<div id="post-box" class="post">
{#    <div class="card" onclick='$("#modal-post").addClass("is-active")'>#}
{#        <div class="card-image">#}
{#            <figure class="image is-4by3">#}
{#                <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">#}
{#            </figure>#}
{#        </div>#}
{#        <div class="card-content">#}
{#            <div class="media">#}
{#                <div class="media-left">#}
{#                    <figure class="image is-48x48">#}
{#                        <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">#}
{#                    </figure>#}
{#                </div>#}
{#                <div class="media-content">#}
{#                    <p class="title is-4">John Smith</p>#}
{#                    <p class="subtitle is-6">@johnsmith</p>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="content">#}
{#                Lorem ipsum dolor sit amet, consectetur adipiscing elit.#}
{#                Phasellus nec iaculis mauris. <a>@bulmaio</a>.#}
{#                <a href="#">#css</a> <a href="#">#responsive</a>#}
{#                <br>#}
{#                <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#    <div class="modal" id="modal-post">#}
{#        <div class="modal-background" onclick='$("#modal-post").removeClass("is-active")'></div>#}
{#        <div class="modal-content">#}
{#            <!-- Any other Bulma elements you want -->#}
{#            <div class="card">#}
{#                <div class="card-image">#}
{#                    <figure class="image is-4by3">#}
{#                        <img src="https://bulma.io/images/placeholders/1280x960.png" alt="Placeholder image">#}
{#                    </figure>#}
{#                </div>#}
{#                <div class="card-content">#}
{#                    <div class="media">#}
{#                        <div class="media-left">#}
{#                            <figure class="image is-48x48">#}
{#                                <img src="https://bulma.io/images/placeholders/96x96.png" alt="Placeholder image">#}
{#                            </figure>#}
{#                        </div>#}
{#                        <div class="media-content">#}
{#                            <p class="title is-4">John Smith</p>#}
{#                            <p class="subtitle is-6">@johnsmith</p>#}
{#                        </div>#}
{#                    </div>#}
{##}
{#                    <div class="content">#}
{#                        Lorem ipsum dolor sit amet, consectetur adipiscing elit.#}
{#                        Phasellus nec iaculis mauris. <a>@bulmaio</a>.#}
{#                        <a href="#">#css</a> <a href="#">#responsive</a>#}
{#                        <br>#}
{#                        <time datetime="2016-1-1">11:09 PM - 1 Jan 2016</time>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#        <button class="modal-close is-large" aria-label="close"#}
{#                onclick='$("#modal-post").removeClass("is-active")'></button>#}
{#    </div>#}
</div>


</div>


<button onclick="posting_test()"> 값들 데베에 넣기</button>

{#<image src="{{ url_for('static', filename='smaple_1.PNG') }}" >#}
{#<image src="./static/smaple_1.PNG" >#}

</body>
</html>

